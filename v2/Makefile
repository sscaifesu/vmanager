# Makefile for vmanager v2.0
# Proxmox è™šæ‹Ÿæœºç®¡ç†å·¥å…·

CC = gcc
CFLAGS = -Wall -Wextra -O2 -std=c11
TARGET = vmanager
SOURCE = vmanager.c
INSTALL_DIR = /usr/local/bin

.PHONY: all clean install uninstall test help

all: $(TARGET)

$(TARGET): $(SOURCE)
	@echo "ğŸ”¨ ç¼–è¯‘ $(TARGET) v2.0..."
	$(CC) $(CFLAGS) -o $(TARGET) $(SOURCE)
	@echo "âœ… ç¼–è¯‘å®Œæˆï¼"
	@echo ""
	@echo "ä½¿ç”¨æ–¹æ³•:"
	@echo "  sudo ./$(TARGET) --help      - æŸ¥çœ‹å¸®åŠ©"
	@echo "  sudo ./$(TARGET) --version   - æŸ¥çœ‹ç‰ˆæœ¬"
	@echo "  sudo ./$(TARGET) start 100   - å¯åŠ¨ VM 100"
	@echo "  make install                 - å®‰è£…åˆ°ç³»ç»Ÿ"

clean:
	@echo "ğŸ§¹ æ¸…ç†ç¼–è¯‘æ–‡ä»¶..."
	rm -f $(TARGET)
	@echo "âœ… æ¸…ç†å®Œæˆï¼"

install: $(TARGET)
	@echo "ğŸ“¦ å®‰è£… $(TARGET) åˆ° $(INSTALL_DIR)..."
	install -m 755 $(TARGET) $(INSTALL_DIR)/$(TARGET)
	@echo "âœ… å®‰è£…å®Œæˆï¼"
	@echo ""
	@echo "ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨:"
	@echo "  sudo $(TARGET) --help"
	@echo "  sudo $(TARGET) start 100"

uninstall:
	@echo "ğŸ—‘ï¸  å¸è½½ $(TARGET)..."
	rm -f $(INSTALL_DIR)/$(TARGET)
	@echo "âœ… å¸è½½å®Œæˆï¼"

test: $(TARGET)
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	@echo ""
	@echo "æµ‹è¯• 1: æ˜¾ç¤ºå¸®åŠ©"
	@./$(TARGET) --help | head -20
	@echo ""
	@echo "æµ‹è¯• 2: æ˜¾ç¤ºç‰ˆæœ¬"
	@./$(TARGET) --version
	@echo ""
	@echo "âœ… æµ‹è¯•å®Œæˆï¼"

help:
	@echo "vmanager v2.0 - Makefile å¸®åŠ©"
	@echo ""
	@echo "å¯ç”¨ç›®æ ‡:"
	@echo "  make          - ç¼–è¯‘ç¨‹åº"
	@echo "  make clean    - æ¸…ç†ç¼–è¯‘æ–‡ä»¶"
	@echo "  make install  - å®‰è£…åˆ°ç³»ç»Ÿ (éœ€è¦ root)"
	@echo "  make uninstall- ä»ç³»ç»Ÿå¸è½½ (éœ€è¦ root)"
	@echo "  make test     - è¿è¡Œæµ‹è¯•"
	@echo "  make help     - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"
	@echo ""
	@echo "ä½¿ç”¨ç¤ºä¾‹:"
	@echo "  make && sudo ./$(TARGET) --help"
	@echo "  sudo make install && sudo $(TARGET) start 100"
